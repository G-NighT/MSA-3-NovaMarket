http {
    upstream logistics_backend {
        # если за 30 секунд случится 5 ошибок подряд, тогда сервер считается упавшим на 30 секунд
        server logistics.company.com max_fails=5 fail_timeout=30s;
    }

    server {
        listen 8080;

        location /logistics/ {
            proxy_pass http://logistics_backend;
            proxy_connect_timeout 3s;
            proxy_read_timeout 3s;
            proxy_next_upstream off; # не пытаться перепрыгивать на другие upstream'ы

            # перехватываем ответы с ошибками и отдаём fallback
            proxy_intercept_errors on;
            error_page 502 503 504 500 = @logistics_fallback;
        }

        location @logistics_fallback {
            add_header Content-Type application/json;
            return 200 '{"status":"unavailable","message":"Logistics service temporarily unavailable"}';
        }
    }
}
